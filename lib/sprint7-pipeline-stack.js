"use strict";
// Import statements
Object.defineProperty(exports, "__esModule", { value: true });
exports.sprint7FarhanPipelineStack = void 0;
const aws_cdk_lib_1 = require("aws-cdk-lib"); //  For stack class and for fetching secret from secretsmanager
const aws_iam_1 = require("aws-cdk-lib/aws-iam"); //  For creating pipeline IAM Role
const pipelines_1 = require("aws-cdk-lib/pipelines"); //  For creating code pipeline
const aws_codepipeline_actions_1 = require("aws-cdk-lib/aws-codepipeline-actions"); //  For Setting the github as trigger for the pipeline
const sprint7_infra_stage_1 = require("../lib/sprint7-infra-stage"); //  For Staging
// Defination Statements
class sprint7FarhanPipelineStack extends aws_cdk_lib_1.Stack {
    constructor(scope, id, props) {
        super(scope, id, props);
        // Create IAM role for pipeline
        const PipelineRole = new aws_iam_1.Role(this, 'cwRole', {
            assumedBy: new aws_iam_1.CompositePrincipal(// Composite Principle
            new aws_iam_1.ServicePrincipal("lambda.amazonaws.com"), // Lambda Default Permissions
            new aws_iam_1.ServicePrincipal("sns.amazonaws.com"), // Lambda SNS Permissions
            new aws_iam_1.ServicePrincipal("codebuild.amazonaws.com") // Lambda CodeBuild Permissions
            ),
            managedPolicies: [
                aws_iam_1.ManagedPolicy.fromAwsManagedPolicyName('service-role/AWSLambdaBasicExecutionRole'),
                aws_iam_1.ManagedPolicy.fromAwsManagedPolicyName('CloudWatchFullAccess'),
                aws_iam_1.ManagedPolicy.fromAwsManagedPolicyName("AmazonDynamoDBFullAccess"),
                aws_iam_1.ManagedPolicy.fromAwsManagedPolicyName("AwsCloudFormationFullAccess"),
                aws_iam_1.ManagedPolicy.fromAwsManagedPolicyName("AWSCodePipeline_FullAccess"),
                aws_iam_1.ManagedPolicy.fromAwsManagedPolicyName("AmazonS3FullAccess"),
                aws_iam_1.ManagedPolicy.fromAwsManagedPolicyName("AmazonAPIGatewayInvokeFullAccess"),
            ],
            description: "This is a IAM role for the application pipeline",
        });
        // Create constants that will be used by the pipeline
        const pipelineTrigger = aws_codepipeline_actions_1.GitHubTrigger.POLL; // Create pipeline trigger
        const piplineSecret = aws_cdk_lib_1.SecretValue.secretsManager("farhan_voyager_github"); // Set iam roles for pipeline
        // Create Pipeline
        const pipeline = new pipelines_1.CodePipeline(this, 'Pipeline_Farhan_Voyager', {
            pipelineName: 'Pipeline_Farhan_Voyager',
            synth: new pipelines_1.CodeBuildStep('Synth', {
                input: pipelines_1.CodePipelineSource.gitHub("farhan2022skipq/Voyager", "main", {
                    authentication: piplineSecret,
                    trigger: pipelineTrigger,
                }),
                commands: [
                    'cd ./farhan/sprint7',
                    'npm install',
                    "npm install -g aws-cdk",
                    'cd ./layers/nodejs',
                    'npm install',
                    'cd ../..',
                    'cd frontend',
                    'npm install',
                    'cd ..',
                    'npx cdk synth' // Create cloudformation template
                ],
                primaryOutputDirectory: "./farhan/sprint7/cdk.out",
                role: PipelineRole // Giving required roles to the pipeline
            }),
        });
        // Define stages
        const beta = new sprint7_infra_stage_1.sprint7FarhanInfraStage(this, "beta", { env: { account: '315997497220', region: 'us-west-1' }, }); // Create beta stage
        const prod = new sprint7_infra_stage_1.sprint7FarhanInfraStage(this, "prod", { env: { account: '315997497220', region: 'us-west-1' }, }); // Create prod stage
        // Define initial tests
        const init_test = new pipelines_1.ShellStep("Unit Test", {
            commands: [
                "cd ./farhan/sprint7",
                "npm install",
                "npm install -g aws-cdk",
                "npm run test" // Run Tests
            ]
        });
        pipeline.addStage(beta, {
            pre: [init_test] // Make sure that stage is only deployed if it passes the unit tests
        });
        pipeline.addStage(prod, {
            pre: [new pipelines_1.ManualApprovalStep("Farhan-Approval")] // Make sure that stage is only deployed if it is manually approved
        });
    }
}
exports.sprint7FarhanPipelineStack = sprint7FarhanPipelineStack;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3ByaW50Ny1waXBlbGluZS1zdGFjay5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInNwcmludDctcGlwZWxpbmUtc3RhY2sudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLG9CQUFvQjs7O0FBRXBCLDZDQUE2RCxDQUEyRSwrREFBK0Q7QUFDdk0saURBQWdHLENBQXdDLGtDQUFrQztBQUMxSyxxREFBdUgsQ0FBaUIsOEJBQThCO0FBQ3RLLG1GQUFxRSxDQUFtRSxzREFBc0Q7QUFFOUwsb0VBQXFFLENBQW1FLGVBQWU7QUFFdkosd0JBQXdCO0FBRXhCLE1BQWEsMEJBQTJCLFNBQVEsbUJBQUs7SUFDakQsWUFBWSxLQUFnQixFQUFFLEVBQVUsRUFBRSxLQUFrQjtRQUN4RCxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUV4QiwrQkFBK0I7UUFFL0IsTUFBTSxZQUFZLEdBQUcsSUFBSSxjQUFJLENBQUMsSUFBSSxFQUFFLFFBQVEsRUFBRTtZQUMxQyxTQUFTLEVBQUUsSUFBSSw0QkFBa0IsQ0FBMkYsc0JBQXNCO1lBQzlJLElBQUksMEJBQWdCLENBQUMsc0JBQXNCLENBQUMsRUFBNEUsNkJBQTZCO1lBQ3JKLElBQUksMEJBQWdCLENBQUMsbUJBQW1CLENBQUMsRUFBK0UseUJBQXlCO1lBQ2pKLElBQUksMEJBQWdCLENBQUMseUJBQXlCLENBQUMsQ0FBeUUsK0JBQStCO2FBQzFKO1lBQ0QsZUFBZSxFQUFFO2dCQUNiLHVCQUFhLENBQUMsd0JBQXdCLENBQUMsMENBQTBDLENBQUM7Z0JBQ2xGLHVCQUFhLENBQUMsd0JBQXdCLENBQUMsc0JBQXNCLENBQUM7Z0JBQzlELHVCQUFhLENBQUMsd0JBQXdCLENBQUMsMEJBQTBCLENBQUM7Z0JBQ2xFLHVCQUFhLENBQUMsd0JBQXdCLENBQUMsNkJBQTZCLENBQUM7Z0JBQ3JFLHVCQUFhLENBQUMsd0JBQXdCLENBQUMsNEJBQTRCLENBQUM7Z0JBQ3BFLHVCQUFhLENBQUMsd0JBQXdCLENBQUMsb0JBQW9CLENBQUM7Z0JBQzVELHVCQUFhLENBQUMsd0JBQXdCLENBQUMsa0NBQWtDLENBQUM7YUFDN0U7WUFDRCxXQUFXLEVBQUUsaURBQWlEO1NBQ2pFLENBQUMsQ0FBQztRQUVILHFEQUFxRDtRQUVyRCxNQUFNLGVBQWUsR0FBRyx3Q0FBYSxDQUFDLElBQUksQ0FBQSxDQUFzRiwwQkFBMEI7UUFDMUosTUFBTSxhQUFhLEdBQUcseUJBQVcsQ0FBQyxjQUFjLENBQUMsdUJBQXVCLENBQUMsQ0FBQSxDQUF1RCw2QkFBNkI7UUFFN0osa0JBQWtCO1FBRWxCLE1BQU0sUUFBUSxHQUFHLElBQUksd0JBQVksQ0FBQyxJQUFJLEVBQUUseUJBQXlCLEVBQUU7WUFDL0QsWUFBWSxFQUFFLHlCQUF5QjtZQUN2QyxLQUFLLEVBQUUsSUFBSSx5QkFBYSxDQUFDLE9BQU8sRUFBRTtnQkFDOUIsS0FBSyxFQUFFLDhCQUFrQixDQUFDLE1BQU0sQ0FBQyx5QkFBeUIsRUFBRSxNQUFNLEVBQUU7b0JBQzVELGNBQWMsRUFBQyxhQUFhO29CQUM1QixPQUFPLEVBQUUsZUFBZTtpQkFFL0IsQ0FBQztnQkFDRixRQUFRLEVBQUU7b0JBQ1IscUJBQXFCO29CQUNyQixhQUFhO29CQUNiLHdCQUF3QjtvQkFDeEIsb0JBQW9CO29CQUNwQixhQUFhO29CQUNiLFVBQVU7b0JBQ1YsYUFBYTtvQkFDYixhQUFhO29CQUNiLE9BQU87b0JBQ1AsZUFBZSxDQUF1RyxpQ0FBaUM7aUJBQ3hKO2dCQUNELHNCQUFzQixFQUFFLDBCQUEwQjtnQkFDbEQsSUFBSSxFQUFFLFlBQVksQ0FBc0csd0NBQXdDO2FBQ25LLENBQUM7U0FDTCxDQUFDLENBQUM7UUFFSCxnQkFBZ0I7UUFFaEIsTUFBTSxJQUFJLEdBQUcsSUFBSSw2Q0FBdUIsQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLEVBQUMsR0FBRyxFQUFFLEVBQUUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLEdBQUUsQ0FBQyxDQUFBLENBQWdCLG9CQUFvQjtRQUNwSixNQUFNLElBQUksR0FBRyxJQUFJLDZDQUF1QixDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsRUFBQyxHQUFHLEVBQUUsRUFBRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUUsR0FBRSxDQUFDLENBQUEsQ0FBZ0Isb0JBQW9CO1FBRXBKLHVCQUF1QjtRQUV2QixNQUFNLFNBQVMsR0FBRyxJQUFJLHFCQUFTLENBQUMsV0FBVyxFQUFFO1lBQ3pDLFFBQVEsRUFBQztnQkFDRyxxQkFBcUI7Z0JBQ3JCLGFBQWE7Z0JBQ2Isd0JBQXdCO2dCQUN4QixjQUFjLENBQWtHLFlBQVk7YUFDL0g7U0FDWixDQUFDLENBQUE7UUFFRixRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRTtZQUNwQixHQUFHLEVBQUUsQ0FBQyxTQUFTLENBQUMsQ0FBNEcsb0VBQW9FO1NBQ25NLENBQUMsQ0FBQTtRQUNGLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFO1lBQ3BCLEdBQUcsRUFBRSxDQUFDLElBQUksOEJBQWtCLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUE0RSxtRUFBbUU7U0FDbE0sQ0FBQyxDQUFBO0lBQ04sQ0FBQztDQUNKO0FBL0VELGdFQStFQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEltcG9ydCBzdGF0ZW1lbnRzXG5cbmltcG9ydCB7IFN0YWNrLCBTdGFja1Byb3BzLCBTZWNyZXRWYWx1ZSB9IGZyb20gJ2F3cy1jZGstbGliJzsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgRm9yIHN0YWNrIGNsYXNzIGFuZCBmb3IgZmV0Y2hpbmcgc2VjcmV0IGZyb20gc2VjcmV0c21hbmFnZXJcbmltcG9ydCB7IFJvbGUsIFNlcnZpY2VQcmluY2lwYWwsIE1hbmFnZWRQb2xpY3ksIENvbXBvc2l0ZVByaW5jaXBhbCB9IGZyb20gJ2F3cy1jZGstbGliL2F3cy1pYW0nOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgRm9yIGNyZWF0aW5nIHBpcGVsaW5lIElBTSBSb2xlXG5pbXBvcnQgeyBDb2RlUGlwZWxpbmUsIENvZGVQaXBlbGluZVNvdXJjZSwgQ29kZUJ1aWxkU3RlcCwgU2hlbGxTdGVwLCBNYW51YWxBcHByb3ZhbFN0ZXAgfSBmcm9tICdhd3MtY2RrLWxpYi9waXBlbGluZXMnOyAgICAgICAgICAgICAgICAgLy8gIEZvciBjcmVhdGluZyBjb2RlIHBpcGVsaW5lXG5pbXBvcnQgeyBHaXRIdWJUcmlnZ2VyIH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWNvZGVwaXBlbGluZS1hY3Rpb25zJzsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIEZvciBTZXR0aW5nIHRoZSBnaXRodWIgYXMgdHJpZ2dlciBmb3IgdGhlIHBpcGVsaW5lXG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJzsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIEFXUyBDb25zdHJ1Y3QgTGlicmFyeVxuaW1wb3J0IHsgc3ByaW50N0ZhcmhhbkluZnJhU3RhZ2UgfSBmcm9tICcuLi9saWIvc3ByaW50Ny1pbmZyYS1zdGFnZSc7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBGb3IgU3RhZ2luZ1xuXG4vLyBEZWZpbmF0aW9uIFN0YXRlbWVudHNcblxuZXhwb3J0IGNsYXNzIHNwcmludDdGYXJoYW5QaXBlbGluZVN0YWNrIGV4dGVuZHMgU3RhY2sgeyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE1haW4gc3RhY2sgY2xhc3NcbiAgICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wcz86IFN0YWNrUHJvcHMpIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTdGFjayBJbml0aWFsaXphdGlvbiBmdW5jdGlvblxuICAgICAgICBzdXBlcihzY29wZSwgaWQsIHByb3BzKTtcbiAgICAgICAgXG4gICAgICAgIC8vIENyZWF0ZSBJQU0gcm9sZSBmb3IgcGlwZWxpbmVcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IFBpcGVsaW5lUm9sZSA9IG5ldyBSb2xlKHRoaXMsICdjd1JvbGUnLCB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSUFNIFJvbGUgZm9yIHRoZSBwaXBlbGluZVxuICAgICAgICAgICAgYXNzdW1lZEJ5OiBuZXcgQ29tcG9zaXRlUHJpbmNpcGFsKCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENvbXBvc2l0ZSBQcmluY2lwbGVcbiAgICAgICAgICAgICAgICBuZXcgU2VydmljZVByaW5jaXBhbChcImxhbWJkYS5hbWF6b25hd3MuY29tXCIpLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIExhbWJkYSBEZWZhdWx0IFBlcm1pc3Npb25zXG4gICAgICAgICAgICAgICAgbmV3IFNlcnZpY2VQcmluY2lwYWwoXCJzbnMuYW1hem9uYXdzLmNvbVwiKSwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBMYW1iZGEgU05TIFBlcm1pc3Npb25zXG4gICAgICAgICAgICAgICAgbmV3IFNlcnZpY2VQcmluY2lwYWwoXCJjb2RlYnVpbGQuYW1hem9uYXdzLmNvbVwiKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBMYW1iZGEgQ29kZUJ1aWxkIFBlcm1pc3Npb25zXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgbWFuYWdlZFBvbGljaWVzOiBbXG4gICAgICAgICAgICAgICAgTWFuYWdlZFBvbGljeS5mcm9tQXdzTWFuYWdlZFBvbGljeU5hbWUoJ3NlcnZpY2Utcm9sZS9BV1NMYW1iZGFCYXNpY0V4ZWN1dGlvblJvbGUnKSwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQVdTIExhbWJkYSBiYXNpYyBleGVjdXRpb24gcm9sZVxuICAgICAgICAgICAgICAgIE1hbmFnZWRQb2xpY3kuZnJvbUF3c01hbmFnZWRQb2xpY3lOYW1lKCdDbG91ZFdhdGNoRnVsbEFjY2VzcycpLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFXUyBDbG91ZHdhdGNoIGZ1bGwgYWNjZXNzIHJvbGVcbiAgICAgICAgICAgICAgICBNYW5hZ2VkUG9saWN5LmZyb21Bd3NNYW5hZ2VkUG9saWN5TmFtZShcIkFtYXpvbkR5bmFtb0RCRnVsbEFjY2Vzc1wiKSwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFXUyBEeW5hbW9EQiBmdWxsIGFjY2VzcyByb2xlXG4gICAgICAgICAgICAgICAgTWFuYWdlZFBvbGljeS5mcm9tQXdzTWFuYWdlZFBvbGljeU5hbWUoXCJBd3NDbG91ZEZvcm1hdGlvbkZ1bGxBY2Nlc3NcIiksICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBV1MgQ2xvdWRGb3JtYXRpb24gZnVsbCBhY2Nlc3Mgcm9sZVxuICAgICAgICAgICAgICAgIE1hbmFnZWRQb2xpY3kuZnJvbUF3c01hbmFnZWRQb2xpY3lOYW1lKFwiQVdTQ29kZVBpcGVsaW5lX0Z1bGxBY2Nlc3NcIiksICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQVdTIENvZGUgUGlwZWxpbmUgZnVsbCBhY2Nlc3Mgcm9sZVxuICAgICAgICAgICAgICAgIE1hbmFnZWRQb2xpY3kuZnJvbUF3c01hbmFnZWRQb2xpY3lOYW1lKFwiQW1hem9uUzNGdWxsQWNjZXNzXCIpLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQVdTIFMzIGZ1bGwgYWNjZXNzIHJvbGVcbiAgICAgICAgICAgICAgICBNYW5hZ2VkUG9saWN5LmZyb21Bd3NNYW5hZ2VkUG9saWN5TmFtZShcIkFtYXpvbkFQSUdhdGV3YXlJbnZva2VGdWxsQWNjZXNzXCIpLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFXUyBBUEkgR2F0ZXdheSBmdWxsIGFjY2VzcyByb2xlXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiVGhpcyBpcyBhIElBTSByb2xlIGZvciB0aGUgYXBwbGljYXRpb24gcGlwZWxpbmVcIiwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGVzY3JpcHRpb24gb2YgdGhlIElBTSBSb2xlXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgLy8gQ3JlYXRlIGNvbnN0YW50cyB0aGF0IHdpbGwgYmUgdXNlZCBieSB0aGUgcGlwZWxpbmVcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHBpcGVsaW5lVHJpZ2dlciA9IEdpdEh1YlRyaWdnZXIuUE9MTCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIHBpcGVsaW5lIHRyaWdnZXJcbiAgICAgICAgY29uc3QgcGlwbGluZVNlY3JldCA9IFNlY3JldFZhbHVlLnNlY3JldHNNYW5hZ2VyKFwiZmFyaGFuX3ZveWFnZXJfZ2l0aHViXCIpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCBpYW0gcm9sZXMgZm9yIHBpcGVsaW5lXG4gICAgICAgIFxuICAgICAgICAvLyBDcmVhdGUgUGlwZWxpbmVcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHBpcGVsaW5lID0gbmV3IENvZGVQaXBlbGluZSh0aGlzLCAnUGlwZWxpbmVfRmFyaGFuX1ZveWFnZXInLCB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIFBpcGVsaW5lXG4gICAgICAgICAgICBwaXBlbGluZU5hbWU6ICdQaXBlbGluZV9GYXJoYW5fVm95YWdlcicsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IG5hbWUgZm9yIHRoZSBwaXBlbGluZVxuICAgICAgICAgICAgc3ludGg6IG5ldyBDb2RlQnVpbGRTdGVwKCdTeW50aCcsIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCBjZGsgc3ludGggY29uZmlndXJhdGlvbiBmb3IgcGlwZWxpbmVcbiAgICAgICAgICAgICAgICBpbnB1dDogQ29kZVBpcGVsaW5lU291cmNlLmdpdEh1YihcImZhcmhhbjIwMjJza2lwcS9Wb3lhZ2VyXCIsIFwibWFpblwiLCB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHBpcGVsaW5lIGlucHV0IG1ldGhvZCBhcyBnaXRodWJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dGhlbnRpY2F0aW9uOnBpcGxpbmVTZWNyZXQsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBHaXRodWIgcmVwbyBuYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyOiBwaXBlbGluZVRyaWdnZXIsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gR2l0aHViIHJlcG8gYnJhbmNoXG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBjb21tYW5kczogWyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgY29tbWFuZHMgdG8gYmUgdXNlZCB3aGlsZSBjcmVhdGluZyBwaXBlbGluZSBzdGFnZXNcbiAgICAgICAgICAgICAgICAgICdjZCAuL2Zhcmhhbi9zcHJpbnQ3JywgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGFuZ2UgZGlyZWN0b3J5IHRvIHRoZSBhcHBsaWNhdGlvbiBmb2xkZXJcbiAgICAgICAgICAgICAgICAgICducG0gaW5zdGFsbCcsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJbnN0YWxsIGFwcGxpY2F0aW9uIHJlcXVpcmVtZW50c1xuICAgICAgICAgICAgICAgICAgXCJucG0gaW5zdGFsbCAtZyBhd3MtY2RrXCIsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSW5zdGFsIGF3cyBjZGtcbiAgICAgICAgICAgICAgICAgICdjZCAuL2xheWVycy9ub2RlanMnLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGFuZ2UgZGlyZWN0b3J5IHRvIHRoZSBsYXllcnMvbm9kZWpzIGZvbGRlclxuICAgICAgICAgICAgICAgICAgJ25wbSBpbnN0YWxsJywgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEluc3RhbGwgbGF5ZXIgcmVxdWlyZW1lbnRzXG4gICAgICAgICAgICAgICAgICAnY2QgLi4vLi4nLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2hhbmdlIGRpcmVjdG9yeSBiYWNrIHRvIHRoZSBhcHBsaWNhdGlvbiBmb2xkZXJcbiAgICAgICAgICAgICAgICAgICdjZCBmcm9udGVuZCcsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGFuZ2UgZGlyZWN0b3J5IHRvIHRoZSBmcm9udGVuZCBmb2xkZXJcbiAgICAgICAgICAgICAgICAgICducG0gaW5zdGFsbCcsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJbnN0YWxsIGZyb250ZW5kIHJlcXVpcmVtZW50c1xuICAgICAgICAgICAgICAgICAgJ2NkIC4uJywgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENoYW5nZSBkaXJlY3RvcnkgYmFjayB0byB0aGUgYXBwbGljYXRpb24gZm9sZGVyXG4gICAgICAgICAgICAgICAgICAnbnB4IGNkayBzeW50aCcgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGNsb3VkZm9ybWF0aW9uIHRlbXBsYXRlXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBwcmltYXJ5T3V0cHV0RGlyZWN0b3J5OiBcIi4vZmFyaGFuL3NwcmludDcvY2RrLm91dFwiLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE91dHB1dCBkaXJlY3RvcnkgZm9yIGFwcGxpY2F0aW9uIGRlcGxveW1lbnRcbiAgICAgICAgICAgICAgICByb2xlOiBQaXBlbGluZVJvbGUgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBHaXZpbmcgcmVxdWlyZWQgcm9sZXMgdG8gdGhlIHBpcGVsaW5lXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICAvLyBEZWZpbmUgc3RhZ2VzXG4gICAgICAgIFxuICAgICAgICBjb25zdCBiZXRhID0gbmV3IHNwcmludDdGYXJoYW5JbmZyYVN0YWdlKHRoaXMsIFwiYmV0YVwiLCB7ZW52OiB7IGFjY291bnQ6ICczMTU5OTc0OTcyMjAnLCByZWdpb246ICd1cy13ZXN0LTEnIH0sfSkgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGJldGEgc3RhZ2VcbiAgICAgICAgY29uc3QgcHJvZCA9IG5ldyBzcHJpbnQ3RmFyaGFuSW5mcmFTdGFnZSh0aGlzLCBcInByb2RcIiwge2VudjogeyBhY2NvdW50OiAnMzE1OTk3NDk3MjIwJywgcmVnaW9uOiAndXMtd2VzdC0xJyB9LH0pICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBwcm9kIHN0YWdlXG4gICAgICAgIFxuICAgICAgICAvLyBEZWZpbmUgaW5pdGlhbCB0ZXN0c1xuICAgICAgICBcbiAgICAgICAgY29uc3QgaW5pdF90ZXN0ID0gbmV3IFNoZWxsU3RlcChcIlVuaXQgVGVzdFwiLCB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB1bml0IHRlc3RzIGZvciBiZXRhIHN0YWdlXG4gICAgICAgICAgICBjb21tYW5kczpbICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IGNvbW1hbmRzIHRvIGJlIHVzZWQgd2hpbGUgdGVzdGluZyB0aGUgYmV0YSBzdGFnZVxuICAgICAgICAgICAgICAgICAgICAgICAgXCJjZCAuL2Zhcmhhbi9zcHJpbnQ3XCIsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2hhbmdlIGRpcmVjdG9yeSB0byB0aGUgYXBwbGljYXRpb24gZm9sZGVyXG4gICAgICAgICAgICAgICAgICAgICAgICBcIm5wbSBpbnN0YWxsXCIsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJbnN0YWxsIGFwcGxpY2F0aW9uIGRldmVsb3BtZW50IHN0YWdlIHJlcXVpcmVtZW50c1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJucG0gaW5zdGFsbCAtZyBhd3MtY2RrXCIsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSW5zdGFsIGF3cyBjZGtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibnBtIHJ1biB0ZXN0XCIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJ1biBUZXN0c1xuICAgICAgICAgICAgICAgICAgICBdICAgXG4gICAgICAgIH0pXG4gICAgICAgIFxuICAgICAgICBwaXBlbGluZS5hZGRTdGFnZShiZXRhLCB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZCBiZXRhIHN0YWdlIHRvIHRoZSBwaXBlbGluZVxuICAgICAgICAgICAgcHJlOiBbaW5pdF90ZXN0XSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHN0YWdlIGlzIG9ubHkgZGVwbG95ZWQgaWYgaXQgcGFzc2VzIHRoZSB1bml0IHRlc3RzXG4gICAgICAgIH0pXG4gICAgICAgIHBpcGVsaW5lLmFkZFN0YWdlKHByb2QsIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIGJldGEgc3RhZ2UgdG8gdGhlIHBpcGVsaW5lXG4gICAgICAgICAgICBwcmU6IFtuZXcgTWFudWFsQXBwcm92YWxTdGVwKFwiRmFyaGFuLUFwcHJvdmFsXCIpXSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCBzdGFnZSBpcyBvbmx5IGRlcGxveWVkIGlmIGl0IGlzIG1hbnVhbGx5IGFwcHJvdmVkXG4gICAgICAgIH0pXG4gICAgfVxufSJdfQ==