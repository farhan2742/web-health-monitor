"use strict";
// Import statements
Object.defineProperty(exports, "__esModule", { value: true });
const cdk = require("aws-cdk-lib"); // AWS CDK
const assertions_1 = require("aws-cdk-lib/assertions"); // For creating templates
const sprint7 = require("../lib/sprint7-stack"); // Stack to be tested
//  Tests
// Test if our application have correct no of resources
test('test bucket count', () => {
    const app = new cdk.App(); // Define App
    const stack = new sprint7.sprint7FarhanStack(app, 'MyTestStack'); // Define the stack to be used in tests
    const template = assertions_1.Template.fromStack(stack); // Create the template to use in our tests
    template.resourceCountIs("AWS::S3::Bucket", 1); // Bucket count
});
test('test lambda count', () => {
    const app = new cdk.App(); // Define App
    const stack = new sprint7.sprint7FarhanStack(app, 'MyTestStack'); // Define the stack to be used in tests
    const template = assertions_1.Template.fromStack(stack); // Create the template to use in our tests
    template.resourceCountIs("AWS::Lambda::Function", 5); // Lambda Function count
});
test('test alarm count', () => {
    const app = new cdk.App(); // Define App
    const stack = new sprint7.sprint7FarhanStack(app, 'MyTestStack'); // Define the stack to be used in tests
    const template = assertions_1.Template.fromStack(stack); // Create the template to use in our tests
    template.resourceCountIs("AWS::CloudWatch::Alarm", 6); // CloudWatch Alarm count
});
test('test sns count', () => {
    const app = new cdk.App(); // Define App
    const stack = new sprint7.sprint7FarhanStack(app, 'MyTestStack'); // Define the stack to be used in tests
    const template = assertions_1.Template.fromStack(stack); // Create the template to use in our tests
    template.resourceCountIs("AWS::SNS::Subscription", 2); // SNS Topic count
});
test('test dynamoDB count', () => {
    const app = new cdk.App(); // Define App
    const stack = new sprint7.sprint7FarhanStack(app, 'MyTestStack'); // Define the stack to be used in tests
    const template = assertions_1.Template.fromStack(stack); // Create the template to use in our tests
    template.resourceCountIs("AWS::DynamoDB::Table", 1); // DynamoDB Table count
});
test('test rule count', () => {
    const app = new cdk.App(); // Define App
    const stack = new sprint7.sprint7FarhanStack(app, 'MyTestStack'); // Define the stack to be used in tests
    const template = assertions_1.Template.fromStack(stack); // Create the template to use in our tests
    template.resourceCountIs("AWS::Events::Rule", 1); // Event Rule count
});
// Test if the sns topic have correct protocols and endpoints
test('test email SNSsubscription', () => {
    const app = new cdk.App(); // Define App
    const stack = new sprint7.sprint7FarhanStack(app, 'MyTestStack'); // Define the stack to be used in tests
    const template = assertions_1.Template.fromStack(stack); // Create the template to use in our tests
    template.hasResourceProperties("AWS::SNS::Subscription", {
        "Protocol": "email",
        "Endpoint": "farhan.kiyani.skipq@gmail.com" // SNS Subscripton End Point 
    });
});
test('test lambda SNSsubscription', () => {
    const app = new cdk.App(); // Define App
    const stack = new sprint7.sprint7FarhanStack(app, 'MyTestStack'); // Define the stack to be used in tests
    const template = assertions_1.Template.fromStack(stack); // Create the template to use in our tests
    template.hasResourceProperties("AWS::SNS::Subscription", {
        "Protocol": "lambda",
        "Endpoint": {
            "Fn::GetAtt": [
                "updateDB5B429E44",
                "Arn" // Endpoint Specification
            ]
        }
    });
});
// Test if we have created a cron job for web health function
test('test cronexpression rule', () => {
    const app = new cdk.App(); // Define App
    const stack = new sprint7.sprint7FarhanStack(app, 'MyTestStack'); // Define the stack to be used in test
    const template = assertions_1.Template.fromStack(stack); // Create the template to use in our tests
    template.hasResourceProperties("AWS::Events::Rule", {
        "ScheduleExpression": "cron(* * * * ? *)",
        "State": "ENABLED",
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3ByaW50Ny50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic3ByaW50Ny50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxvQkFBb0I7O0FBRXBCLG1DQUFtQyxDQUEwRCxVQUFVO0FBQ3ZHLHVEQUFrRCxDQUEyQyx5QkFBeUI7QUFDdEgsZ0RBQWdELENBQTZDLHFCQUFxQjtBQUVsSCxTQUFTO0FBRVQsdURBQXVEO0FBRXZELElBQUksQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7SUFDNUIsTUFBTSxHQUFHLEdBQUcsSUFBSSxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBZ0UsYUFBYTtJQUN2RyxNQUFNLEtBQUssR0FBRyxJQUFJLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsYUFBYSxDQUFDLENBQUMsQ0FBeUIsdUNBQXVDO0lBQ2pJLE1BQU0sUUFBUSxHQUFHLHFCQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQStDLDBDQUEwQztJQUNwSSxRQUFRLENBQUMsZUFBZSxDQUFDLGlCQUFpQixFQUFFLENBQUMsQ0FBQyxDQUFDLENBQTJDLGVBQWU7QUFDNUcsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsbUJBQW1CLEVBQUUsR0FBRyxFQUFFO0lBQzVCLE1BQU0sR0FBRyxHQUFHLElBQUksR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQWdFLGFBQWE7SUFDdkcsTUFBTSxLQUFLLEdBQUcsSUFBSSxPQUFPLENBQUMsa0JBQWtCLENBQUMsR0FBRyxFQUFFLGFBQWEsQ0FBQyxDQUFDLENBQXlCLHVDQUF1QztJQUNqSSxNQUFNLFFBQVEsR0FBRyxxQkFBUSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUErQywwQ0FBMEM7SUFDcEksUUFBUSxDQUFDLGVBQWUsQ0FBQyx1QkFBdUIsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFxQyx3QkFBd0I7QUFDckgsQ0FBQyxDQUFDLENB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QUFHLEVBQUU7SUFDdEMsTUFBTSxHQUFHLEdBQUcsSUFBSSxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBZ0UsYUFBYTtJQUN2RyxNQUFNLEtBQUssR0FBRyxJQUFJLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsYUFBYSxDQUFDLENBQUMsQ0FBeUIsdUNBQXVDO0lBQ2pJLE1BQU0sUUFBUSxHQUFHLHFCQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQStDLDBDQUEwQztJQUNwSSxRQUFRLENBQUMscUJBQXFCLENBQUMsd0JBQXdCLEVBQUU7UUFDekQsVUFBVSxFQUFFLFFBQVE7UUFDZixVQUFVLEVBQUU7WUFDVixZQUFZLEVBQUU7Z0JBQ1osa0JBQWtCO2dCQUNsQixLQUFLLENBQTRFLHlCQUF5QjthQUN6RztTQUNKO0tBQ0wsQ0FBQyxDQUFDO0FBQ04sQ0FBQyxDQUFDLENBQUM7QUFHSCw2REFBNkQ7QUFFN0QsSUFBSSxDQUFDLDBCQUEwQixFQUFFLEdBQUcsRUFBRTtJQUNuQyxNQUFNLEdBQUcsR0FBRyxJQUFJLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFnRSxhQUFhO0lBQ3ZHLE1BQU0sS0FBSyxHQUFHLElBQUksT0FBTyxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxhQUFhLENBQUMsQ0FBQyxDQUF5QixzQ0FBc0M7SUFDaEksTUFBTSxRQUFRLEdBQUcscUJBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBK0MsMENBQTBDO0lBQ3BJLFFBQVEsQ0FBQyxxQkFBcUIsQ0FBQyxtQkFBbUIsRUFBRTtRQUMvQyxvQkFBb0IsRUFBRSxtQkFBbUI7UUFDekMsT0FBTyxFQUFFLFNBQVM7S0FDbkIsQ0FBQyxDQUFBO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBJbXBvcnQgc3RhdGVtZW50c1xuXG5pbXBvcnQgKiBhcyBjZGsgZnJvbSAnYXdzLWNkay1saWInOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBV1MgQ0RLXG5pbXBvcnQgeyBUZW1wbGF0ZSB9IGZyb20gJ2F3cy1jZGstbGliL2Fzc2VydGlvbnMnOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBGb3IgY3JlYXRpbmcgdGVtcGxhdGVzXG5pbXBvcnQgKiBhcyBzcHJpbnQ3IGZyb20gJy4uL2xpYi9zcHJpbnQ3LXN0YWNrJzsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTdGFjayB0byBiZSB0ZXN0ZWRcblxuLy8gIFRlc3RzXG5cbi8vIFRlc3QgaWYgb3VyIGFwcGxpY2F0aW9uIGhhdmUgY29ycmVjdCBubyBvZiByZXNvdXJjZXNcblxudGVzdCgndGVzdCBidWNrZXQgY291bnQnLCAoKSA9PiB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGVzdCB0byBjaGVjayBpZiB3ZSBoYXZlIGNvcnJlY3Qgbm8gb2YgYnVja2V0c1xuICAgY29uc3QgYXBwID0gbmV3IGNkay5BcHAoKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGVmaW5lIEFwcFxuICAgY29uc3Qgc3RhY2sgPSBuZXcgc3ByaW50Ny5zcHJpbnQ3RmFyaGFuU3RhY2soYXBwLCAnTXlUZXN0U3RhY2snKTsgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGVmaW5lIHRoZSBzdGFjayB0byBiZSB1c2VkIGluIHRlc3RzXG4gICBjb25zdCB0ZW1wbGF0ZSA9IFRlbXBsYXRlLmZyb21TdGFjayhzdGFjayk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgdGhlIHRlbXBsYXRlIHRvIHVzZSBpbiBvdXIgdGVzdHNcbiAgIHRlbXBsYXRlLnJlc291cmNlQ291bnRJcyhcIkFXUzo6UzM6OkJ1Y2tldFwiLCAxKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQnVja2V0IGNvdW50XG59KTtcblxudGVzdCgndGVzdCBsYW1iZGEgY291bnQnLCAoKSA9PiB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGVzdCB0byBjaGVjayBpZiB3ZSBoYXZlIGNvcnJlY3Qgbm8gb2YgTGFtYmRhIGZ1bmN0aW9uc1xuICAgY29uc3QgYXBwID0gbmV3IGNkay5BcHAoKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGVmaW5lIEFwcFxuICAgY29uc3Qgc3RhY2sgPSBuZXcgc3ByaW50Ny5zcHJpbnQ3RmFyaGFuU3RhY2soYXBwLCAnTXlUZXN0U3RhY2snKTsgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGVmaW5lIHRoZSBzdGFjayB0byBiZSB1c2VkIGluIHRlc3RzXG4gICBjb25zdCB0ZW1wbGF0ZSA9IFRlbXBsYXRlLmZyb21TdGFjayhzdGFjayk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgdGhlIHRlbXBsYXRlIHRvIHVzZSBpbiBvdXIgdGVzdHNcbiAgIHRlbXBsYXRlLnJlc291cmNlQ291bnRJcyhcIkFXUzo6TGFtYmRhOjpGdW5jdGlvblwiLCA1KTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTGFtYmRhIEZ1bmN0aW9uIGNvdW50XG59KTtcblxudGVzdCgndGVzdCBhbGFybSBjb3VudCcsICgpID0+IHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGVzdCB0byBjaGVjayBpZiB3ZSBoYXZlIHNldCBjb3JyZWN0IG5vIG9mIGFsYXJtc1xuICAgY29uc3QgYXBwID0gbmV3IGNkay5BcHAoKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGVmaW5lIEFwcFxuICAgY29uc3Qgc3RhY2sgPSBuZXcgc3ByaW50Ny5zcHJpbnQ3RmFyaGFuU3RhY2soYXBwLCAnTXlUZXN0U3RhY2snKTsgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGVmaW5lIHRoZSBzdGFjayB0byBiZSB1c2VkIGluIHRlc3RzXG4gICBjb25zdCB0ZW1wbGF0ZSA9IFRlbXBsYXRlLmZyb21TdGFjayhzdGFjayk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgdGhlIHRlbXBsYXRlIHRvIHVzZSBpbiBvdXIgdGVzdHNcbiAgIHRlbXBsYXRlLnJlc291cmNlQ291bnRJcyhcIkFXUzo6Q2xvdWRXYXRjaDo6QWxhcm1cIiwgNik7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2xvdWRXYXRjaCBBbGFybSBjb3VudFxufSk7XG5cbnRlc3QoJ3Rlc3Qgc25zIGNvdW50JywgKCkgPT4geyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRlc3QgdG8gY2hlY2sgaWYgd2UgaGF2ZSBjb3JyZWN0IG5vIG9mIHNucyBydWxlc1xuICAgY29uc3QgYXBwID0gbmV3IGNkay5BcHAoKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGVmaW5lIEFwcFxuICAgY29uc3Qgc3RhY2sgPSBuZXcgc3ByaW50Ny5zcHJpbnQ3RmFyaGFuU3RhY2soYXBwLCAnTXlUZXN0U3RhY2snKTsgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGVmaW5lIHRoZSBzdGFjayB0byBiZSB1c2VkIGluIHRlc3RzXG4gICBjb25zdCB0ZW1wbGF0ZSA9IFRlbXBsYXRlLmZyb21TdGFjayhzdGFjayk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgdGhlIHRlbXBsYXRlIHRvIHVzZSBpbiBvdXIgdGVzdHNcbiAgIHRlbXBsYXRlLnJlc291cmNlQ291bnRJcyhcIkFXUzo6U05TOjpTdWJzY3JpcHRpb25cIiwgMik7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU05TIFRvcGljIGNvdW50XG59KTtcblxudGVzdCgndGVzdCBkeW5hbW9EQiBjb3VudCcsICgpID0+IHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGVzdCB0byBjaGVjayBpZiB3ZSBoYXZlIGNvcnJlY3Qgbm8gb2YgRHluYW1vREIgVGFibGVzXG4gICBjb25zdCBhcHAgPSBuZXcgY2RrLkFwcCgpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBEZWZpbmUgQXBwXG4gICBjb25zdCBzdGFjayA9IG5ldyBzcHJpbnQ3LnNwcmludDdGYXJoYW5TdGFjayhhcHAsICdNeVRlc3RTdGFjaycpOyAgICAgICAgICAgICAgICAgICAgICAgICAvLyBEZWZpbmUgdGhlIHN0YWNrIHRvIGJlIHVzZWQgaW4gdGVzdHNcbiAgIGNvbnN0IHRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSB0aGUgdGVtcGxhdGUgdG8gdXNlIGluIG91ciB0ZXN0c1xuICAgdGVtcGxhdGUucmVzb3VyY2VDb3VudElzKFwiQVdTOjpEeW5hbW9EQjo6VGFibGVcIiwgMSk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBEeW5hbW9EQiBUYWJsZSBjb3VudFxufSk7XG5cbnRlc3QoJ3Rlc3QgcnVsZSBjb3VudCcsICgpID0+IHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRlc3QgdG8gY2hlY2sgaWYgd2UgaGF2ZSBjb3JyZWN0IG5vIG9mIEV2ZW50IFJ1bGVzXG4gICBjb25zdCBhcHAgPSBuZXcgY2RrLkFwcCgpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBEZWZpbmUgQXBwXG4gICBjb25zdCBzdGFjayA9IG5ldyBzcHJpbnQ3LnNwcmludDdGYXJoYW5TdGFjayhhcHAsICdNeVRlc3RTdGFjaycpOyAgICAgICAgICAgICAgICAgICAgICAgICAvLyBEZWZpbmUgdGhlIHN0YWNrIHRvIGJlIHVzZWQgaW4gdGVzdHNcbiAgIGNvbnN0IHRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSB0aGUgdGVtcGxhdGUgdG8gdXNlIGluIG91ciB0ZXN0c1xuICAgdGVtcGxhdGUucmVzb3VyY2VDb3VudElzKFwiQVdTOjpFdmVudHM6OlJ1bGVcIiwgMSk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBFdmVudCBSdWxlIGNvdW50XG59KTtcblxuLy8gVGVzdCBpZiB0aGUgc25zIHRvcGljIGhhdmUgY29ycmVjdCBwcm90b2NvbHMgYW5kIGVuZHBvaW50c1xuXG50ZXN0KCd0ZXN0IGVtYWlsIFNOU3N1YnNjcmlwdGlvbicsICgpID0+IHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUZXN0IHRvIGNoZWNrIGlmIG91ciBzbnMgdG9waWMgaGF2ZSBlbWFpbCBzdWJjcmlwdGlvbiBhbmQgaXQncyBlbmRwb2ludCBpcyBjb3JyZWN0XG4gICBjb25zdCBhcHAgPSBuZXcgY2RrLkFwcCgpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBEZWZpbmUgQXBwXG4gICBjb25zdCBzdGFjayA9IG5ldyBzcHJpbnQ3LnNwcmludDdGYXJoYW5TdGFjayhhcHAsICdNeVRlc3RTdGFjaycpOyAgICAgICAgICAgICAgICAgICAgICAgICAvLyBEZWZpbmUgdGhlIHN0YWNrIHRvIGJlIHVzZWQgaW4gdGVzdHNcbiAgIGNvbnN0IHRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSB0aGUgdGVtcGxhdGUgdG8gdXNlIGluIG91ciB0ZXN0c1xuICAgdGVtcGxhdGUuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKFwiQVdTOjpTTlM6OlN1YnNjcmlwdGlvblwiLCB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZXNvdXJjZSBuYW1lXG4gICAgICAgIFwiUHJvdG9jb2xcIjogXCJlbWFpbFwiLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU05TIFN1YmNyaXB0aW9uIE5hbWVcbiAgICAgICAgXCJFbmRwb2ludFwiOiBcImZhcmhhbi5raXlhbmkuc2tpcHFAZ21haWwuY29tXCIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTTlMgU3Vic2NyaXB0b24gRW5kIFBvaW50IFxuICAgICAgICB9KVxuICAgfSk7XG5cblxudGVzdCgndGVzdCBsYW1iZGEgU05Tc3Vic2NyaXB0aW9uJywgKCkgPT4geyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGVzdCB0byBjaGVjayBpZiBvdXIgc25zIHRvcGljIGhhdmUgbGFtYmRhIHN1YmNyaXB0aW9uIGFuZCBpdCdzIGVuZHBvaW50IGlzIGNvcnJlY3RcbiAgIGNvbnN0IGFwcCA9IG5ldyBjZGsuQXBwKCk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERlZmluZSBBcHBcbiAgIGNvbnN0IHN0YWNrID0gbmV3IHNwcmludDcuc3ByaW50N0ZhcmhhblN0YWNrKGFwcCwgJ015VGVzdFN0YWNrJyk7ICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERlZmluZSB0aGUgc3RhY2sgdG8gYmUgdXNlZCBpbiB0ZXN0c1xuICAgY29uc3QgdGVtcGxhdGUgPSBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIHRoZSB0ZW1wbGF0ZSB0byB1c2UgaW4gb3VyIHRlc3RzXG4gICB0ZW1wbGF0ZS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoXCJBV1M6OlNOUzo6U3Vic2NyaXB0aW9uXCIsIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNOUyBTdWJjcmlwdGlvbiBOYW1lXG4gICBcIlByb3RvY29sXCI6IFwibGFtYmRhXCIsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU05TIFN1YnNjcmlwdG9uIHR5cGUgaXMgTGFtYmRhXG4gICAgICAgIFwiRW5kcG9pbnRcIjogeyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNOUyBTdWJzY3JpcHRvbiBFbmQgUG9pbnQgICAgICAgIFxuICAgICAgICAgIFwiRm46OkdldEF0dFwiOiBbICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0ZXN0IElmIGl0cyBhIGxhbWJkYSBmdW5jdGlvblxuICAgICAgICAgICAgXCJ1cGRhdGVEQjVCNDI5RTQ0XCIsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBMYW1iZGEgZnVuY3Rpb24gQVJOXG4gICAgICAgICAgICBcIkFyblwiICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEVuZHBvaW50IFNwZWNpZmljYXRpb25cbiAgICAgICAgICAgIF1cbiAgICAgICAgfVxuICAgfSk7XG59KTtcblxuXG4vLyBUZXN0IGlmIHdlIGhhdmUgY3JlYXRlZCBhIGNyb24gam9iIGZvciB3ZWIgaGVhbHRoIGZ1bmN0aW9uXG5cbnRlc3QoJ3Rlc3QgY3JvbmV4cHJlc3Npb24gcnVsZScsICgpID0+IHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRlc3RzIGlmIHRoZSB3ZWJoZWFsdGggbGFtYmRhIGlzIGdldHRpbmcgaW52b2tlZCBldmVyeSBtaW51dGUgYnkgY3JvbiBqb2JcbiAgIGNvbnN0IGFwcCA9IG5ldyBjZGsuQXBwKCk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERlZmluZSBBcHBcbiAgIGNvbnN0IHN0YWNrID0gbmV3IHNwcmludDcuc3ByaW50N0ZhcmhhblN0YWNrKGFwcCwgJ015VGVzdFN0YWNrJyk7ICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERlZmluZSB0aGUgc3RhY2sgdG8gYmUgdXNlZCBpbiB0ZXN0XG4gICBjb25zdCB0ZW1wbGF0ZSA9IFRlbXBsYXRlLmZyb21TdGFjayhzdGFjayk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgdGhlIHRlbXBsYXRlIHRvIHVzZSBpbiBvdXIgdGVzdHNcbiAgIHRlbXBsYXRlLmhhc1Jlc291cmNlUHJvcGVydGllcyhcIkFXUzo6RXZlbnRzOjpSdWxlXCIsIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVzb3VyY2UgbmFtZVxuICAgICAgICBcIlNjaGVkdWxlRXhwcmVzc2lvblwiOiBcImNyb24oKiAqICogKiA/ICopXCIsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRlc3QgaWYgdGhlIHJ1bGUgaXMgc2NoZWR1bGVkIGNvcnJlY3RseVxuICAgICAgICBcIlN0YXRlXCI6IFwiRU5BQkxFRFwiLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRlc3QgaWYgdGhlIHJ1bGUgaXMgZW5hYmxlc1xuICAgICAgfSlcbiAgIH0pOyJdfQ==